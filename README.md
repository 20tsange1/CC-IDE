# Final Year Project

A Computable Contract IDE, designed for drafting contracts.

In order to begin using the IDE and install tree-sitter, follow the steps below:

1. Open Terminal
2. Navigate to folder
3. Run `pip3 install -r requirements.txt`
4. Run `python3 app.py`
5. Open up `http://localhost:8080/` in a web browser.

In the case that tree-sitter needs to be installed and configured, you will need to initialise tree-sitter.
This can be done via the steps below:

1. Run `npm install -g tree-sitter-cli`
2. `cd cola`
3. `tree-sitter init-config`
4. `tree-sitter init`

## Current flow of operations:

1. BNF of Grammar written in a text file.
2. BNF is then parsed and evaluated into a Tree-Sitter grammar json file.
3. Tree-Sitter is then used to convert this into a parser
4. We build the language on Python and are now able to parse using this language + traverse our parse trees.
5. The front-end application is hosted on Flask, establishing a web-server.
6. All auxiliary functionality operate on the AST generated by tree-sitter, leveraging a plugin-style structure for extensibility.

## IDE Pages

### Home
The home page contains the main parsing functionality of the IDE. The left hand side contains an editing box for contracts to go within, while the right hand side contains the parsed output along with analytics performed on the contract. For ease of use, contracts can be saved within files.

- ***Analytics:*** Error Analysis (Consistency, does the contract follow the grammar correctly), Time Conflict Analysis
- ***Features:*** Autosuggestion, Syntax Highlighting, Formatting, Error Detection

### Tree
The tree page is more attuned towards a visualisation page of the Abstract Syntax Tree generated from the contract. Currently, the two options are:

***Tree Struct***: An n-ary tree containing the nodes within the AST.

***File Struct***: A hierarchical structure of the nodes and their children.

***Tree view***: Displays the Concrete Syntax Tree (Parse Tree) generated by the Tree-sitter
parser, presenting the direct syntactic structure.
***Hierarchical view***: Presents the contract in a hierarchical structure, showing explicit rela-
tionships and rules.
***AST Hierarchical view***: Offers a simplified and abstracted hierarchical view, focusing on core
contract components.
***Boolean view***: Extracts and visualises the logical structure of the contract, removing template
text.

### Developer
The developer page is where the backend of the parser is applied and created. This allows a developer to write and apply a new or existing legal language, immediately using it within the IDE, making it easier than ever to develop and perfect a legal language. Furthermore, syntax highlighting can be explicitly set by the developer, along with any additional formatting options. This stage requires the developer to write the formatting in CSS.

Furthermore, an additional feature is the ability to upload a file to override the time functionality within the IDE, allowing you to translate time within your language to a python-recognised datetime format.

***BNF Editor***: For writing and applying the BNF of a legal language â€“ utilising BNF -> Treesitter.

***Highlight Options***: Picking colours for syntax highlighting using node types.

***Formatting Options***: For adding additional formatting options such as paragraphs, bolding, and whatever is permitted by CSS.

***Time Override***: Overriding the time translation library within the IDE. An additional guide is provided.


### Analysis

This page is designed for the simulation of contracts provided that the grammar follows the GAS semantics. In particular, the set of features provided in this page focus on the relationship between statements and their associated conditions.
Condition Sim: Conditions are simulated through boolean flags. Clicking the Conditions will revaluate the Statements.
Event Sim: Conditions are simulated by dynamic events. An event can be created and processed, with statements being evaluated with respect to time.

<!-- 
### Output

In cases where a contract will have to be signed and printed on paper, the output page provides just that. A user can output the contract into custom designed templates, bringing the contract into reality to be signed and acknowledged. -->

## Implemented Features:

- Autosuggestion
- Syntax Highlighting
- BNF Parsing
- File saving + editing
- Incremental Parsing
- Different AST View Modes (Tree, Hierarchical)
- Condition and Event Evaluation


A key benefit currently provided by this application is our ability to use grammars as we develop them, making it versatile towards all current legal grammars with a valid BNF.