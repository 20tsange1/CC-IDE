<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text Parser</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div id="container">
        <!-- Left: Text editor -->
        <div id="editor">
            <h2>Edit Text</h2>
            <textarea id="inputText" placeholder="Type your text here..."></textarea>
        </div>

        <!-- Right: Parsed output and highlight options -->
        <div id="containerVert">
            <!-- Parsed output section -->
            <div id="output">
                <h2>Parsed Output</h2>
                <div id="parsedText"></div>
            </div>

            <!-- Highlighter options -->
            <div id="highlighter">
                <h2>Highlight Options</h2>
                <button type="button" id="toggleColorsBtn">Show Colors</button>
                <div id="colorOptionsContainer" style="display: none">
                    <!-- Dynamic color entries will be added here -->
                </div>
                <button type="button" id="saveColorsBtn" style="display: none">Save Colors</button>
            </div>
        </div>
    </div>

    <!-- JavaScript for dynamic content -->
    <script>
        const inputText = document.getElementById('inputText');
        const parsedText = document.getElementById('parsedText');

        // Fetch parsed text from server on input
        inputText.addEventListener('input', () => {
            fetch('/parse', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ text: inputText.value })
            })
            .then(response => response.json())
            .then(data => {
                parsedText.innerHTML = data.parsed_text;
            });
        });
    </script>

    <script>
        const keysArray = {{ node_types | tojson }};
        const colorOptionsContainer = document.getElementById('colorOptionsContainer');
        const toggleColorsBtn = document.getElementById('toggleColorsBtn');
        const saveColorsBtn = document.getElementById('saveColorsBtn');

        // Toggle color options visibility
        toggleColorsBtn.addEventListener('click', () => {
            if (colorOptionsContainer.style.display == 'none') {
                colorOptionsContainer.style.display = 'block';
                saveColorsBtn.style.display = 'block';
                toggleColorsBtn.textContent = "Hide Colours"
            }
            else {
                colorOptionsContainer.style.display = 'none';
                saveColorsBtn.style.display = 'none';
                toggleColorsBtn.textContent = "Show Colours"
            }
        });

        // Create color options
        function createColorOptions() {
            colorOptionsContainer.innerHTML = ''; // Clear existing options

            keysArray.forEach(key => {
                const entryDiv = document.createElement('div');
                entryDiv.classList.add('color-entry');

                // Key label
                const keyLabel = document.createElement('span');
                keyLabel.textContent = key;
                keyLabel.classList.add('key-label');

                // Color input
                const colorInput = document.createElement('input');
                colorInput.type = 'color';
                colorInput.classList.add('color-picker');
                colorInput.name = `${key}Color`;

                entryDiv.appendChild(keyLabel);
                entryDiv.appendChild(colorInput);
                colorOptionsContainer.appendChild(entryDiv);
            });
        }

        // Initialize color options
        createColorOptions();

        // Save colors button functionality
        saveColorsBtn.addEventListener('click', () => {
            const colorData = {};

            // Collect color values for each key
            keysArray.forEach(key => {
                const colorInput = document.querySelector(`input[name="${key}Color"]`);
                colorData[key] = colorInput.value;
            });

            // Send color data to the Flask endpoint
            fetch('/submit-options', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ colors: colorData })
            })
            .then(response => response.text())
            .then(data => {
                console.log("Server response:", data); // Handle the response if needed
                alert("Colors saved successfully!");
            })
            .catch(error => console.error('Error:', error));
        });
    </script>
</body>
</html>
